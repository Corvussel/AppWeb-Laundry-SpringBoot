<link rel="stylesheet" href="/css/client/register-client.css">

<div>
    <div class="flex justify-center">
        <div class="w-11/12 sm:w-11/12 md:w-10/12 lg:w-8/12 my-9">
            <div class="main-container">
                <div class="form-header">
                    <h2 class="font-medium text-base" id="formTitle">Cliente</h2>
                </div>

                <form class="needs-validation" id="clienteForm" novalidate>
                    <input type="hidden" id="clienteId">
                    
                    <div class="mb-3 flex flex-col gap-2">
                        <label for="nombre" class="required text-gray-700">Nombre y Apellido</label>
                        <div class="input-icon">
                            <input type="text" class="form-control w-full" id="nombre" name="nombre" placeholder="Nombre" required>
                            <i class="fas fa-user"></i>
                        </div>
                    </div>

                    <div class="mb-3 flex flex-col gap-2">
                        <label for="telefono" class="text-gray-700">Teléfono</label>
                        <div class="input-icon">
                            <input type="number" class="form-control w-full" required id="telefono" name="telefono"
                                placeholder="Teléfono">
                            <i class="fas fa-phone"></i>
                        </div>
                    </div>

                    <label class="required text-gray-700">Género</label>
                    <div class="gender-group">
                        <button type="button" class="button-outline" data-gender="Femenino">
                            <i class="fas fa-venus me-2"></i> Femenino
                        </button>
                        <button type="button" class="button-outline" data-gender="Masculino">
                            <i class="fas fa-mars me-2"></i> Masculino
                        </button>
                    </div>
                    <input type="hidden" id="genero" name="genero">

                    <div class="mb-3 flex flex-col gap-2">
                        <label for="observaciones" class="text-gray-700">Observaciones de cliente</label>
                        <textarea class="form-control" id="observaciones" name="observaciones" style="height: 100px"
                            placeholder="Observaciones"></textarea>
                    </div>

                    <div class="mb-3 flex flex-col gap-2">
                        <label for="cod_cliente" class="text-gray-700">Codigo Cliente</label>
                        <input type="text" class="form-control" readonly id="cod_cliente" name="codigoCliente" placeholder="Codigo Cliente">
                    </div>

                    <div class="mb-3 flex flex-col gap-2">
                        <label for="direccion" class="text-gray-700">Dirección</label>
                        <div class="input-icon">
                            <input type="text" class="form-control w-full" id="direccion" name="direccion" placeholder="Dirección">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                    </div>

                    <div class="mb-3 flex flex-col gap-2">
                        <label for="distrito" class="text-gray-700">Distrito</label>
                        <div class="input-icon">
                            <input type="text" class="form-control w-full" id="distrito" name="distrito" placeholder="Distrito">
                            <i class="fas fa-city"></i>
                        </div>
                    </div>

                    <div class="mb-3 flex flex-col gap-2">
                        <label for="activo" class="text-gray-700">El cliente esta Activo?</label>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="activo" name="activo" class="form-checkbox w-5 h-5">
                            <span id="activoLabel">Activo</span>
                        </div>
                    </div>
                    

                    <div class="flex justify-end gap-4 pt-4">
                        <button type="button" onclick="history.back()"
                            class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" id="submitButton"
                            class="px-6 py-2 bg-[#0891b2] text-white rounded-lg hover:bg-[#0891b2]/90 transition-colors flex items-center gap-2">
                            <i class="fas fa-user-plus"></i>
                            <span>Registrar Cliente</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('clienteForm');
    const formTitle = document.getElementById('formTitle');
    const submitButton = document.getElementById('submitButton').querySelector('span');
    const genderButtons = document.querySelectorAll('.gender-group button');
    let isEdit = false;

    // Manejar selección de género
    genderButtons.forEach(button => {
        button.addEventListener('click', () => {
            genderButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            document.getElementById('genero').value = button.dataset.gender;
        });
    });

    // Verificar si estamos en modo edición
    const urlParams = new URLSearchParams(window.location.search);
    const clienteId = urlParams.get('id');

    if (clienteId) {
        isEdit = true;
        formTitle.textContent = 'Editar Cliente';
        submitButton.textContent = 'Actualizar Cliente';
        loadClienteData(clienteId);
    }

    // Cargar datos del cliente para edición
    function loadClienteData(id) {
    fetch(`/client/get/${id}`)
        .then(response => response.json())
        .then(data => {
            if (data.success && data.cliente) {
                const cliente = data.cliente;
                document.getElementById('clienteId').value = cliente.id;
                document.getElementById('nombre').value = cliente.nombre;
                document.getElementById('telefono').value = cliente.telefono;
                document.getElementById('observaciones').value = cliente.observaciones;
                document.getElementById('cod_cliente').value = cliente.codigoCliente;
                document.getElementById('direccion').value = cliente.direccion;
                document.getElementById('distrito').value = cliente.distrito;

                // Actualizar checkbox
                const activoCheckbox = document.getElementById('activo');
                activoCheckbox.checked = cliente.activo;

                // Seleccionar género
                const generoButton = document.querySelector(`[data-gender="${cliente.genero}"]`);
                if (generoButton) {
                    generoButton.click();
                }
            }
        });
}

    // Manejar envío del formulario
    form.addEventListener('submit', function(e) {
    e.preventDefault();

    if (!form.checkValidity()) {
        e.stopPropagation();
        form.classList.add('was-validated');
        return;
    }

    const formData = new FormData(form);
    const cliente = Object.fromEntries(formData);

    // Añadir valor del checkbox al objeto cliente
    cliente.activo = document.getElementById('activo').checked;

    const url = isEdit 
        ? `/client/update/${document.getElementById('clienteId').value}`
        : '/client/create';

    fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(cliente)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            window.location.href = '/client/index';
        } else {
            alert(result.message);
        }
    });
});
});

</script>
<!--Apariencia-->
<script src="/js/client/apparence.js"></script>
<!--Funcionalidad-->
<script src="/js/client/funcionality.js"></script>