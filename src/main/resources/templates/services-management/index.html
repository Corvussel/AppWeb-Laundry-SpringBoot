<style>
    body {
        font-family: 'Poppins', sans-serif;
    }
</style>
<div class="min-h-screen" x-data="configuracion">
    <div class="container mx-auto px-4 py-8">
        <!-- Header-encabezado -->
        <div class="mb-8">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">Configuración de Servicios</h1>
            <p class="text-gray-600">Gestiona las categorías y servicios de la lavandería</p>
        </div>

        <div class="grid lg:grid-cols-2 gap-6">
            <!-- seccion categorias -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden flex flex-col">
                <div class="p-6 border-b">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-lg font-semibold text-gray-800">Categorías</h2>
                            <p class="text-sm text-gray-500">Total: 6 categorías</p>
                        </div>
                        <button @click="openCategoryModal = true"
                            class="bg-[#0891b2] text-white px-4 py-2 rounded-lg hover:bg-[#0891b2]/90 transition-colors flex items-center gap-2">
                            <i class="fas fa-plus"></i>
                            <span>Nueva Categoría</span>
                        </button>
                    </div>
                </div>

                <!-- Lista de Categorias -->
                <div class="overflow-y-auto max-h-[600px] p-6 space-y-3">
                    <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div class="bg-blue-100 p-2 rounded-lg">
                                    <i class="fas fa-tshirt text-blue-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-medium text-gray-800">Ropa Normal</h3>
                                    <p class="text-sm text-gray-500">6 servicios activos</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="flex items-center gap-2">
                                    <span
                                        class="px-2 py-1 text-xs rounded-full bg-green-50 text-green-700">Activo</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <a href="/management/categories"
                                        class="p-2 text-gray-600 hover:text-[#0891b2] rounded-lg transition-colors">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a class="p-2 text-gray-600 hover:text-red-500 rounded-lg transition-colors">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- seccion servicios -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden flex flex-col">
                <div class="p-6 border-b">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-lg font-semibold text-gray-800">Servicios</h2>
                            <p class="text-sm text-gray-500">Total: 12 servicios</p>
                        </div>
                        <button @click="openServiceModal = true"
                            class="bg-[#0891b2] text-white px-4 py-2 rounded-lg hover:bg-[#0891b2]/90 transition-colors flex items-center gap-2">
                            <i class="fas fa-plus"></i>
                            <span>Nuevo Servicio</span>
                        </button>
                    </div>
                </div>

                <!-- Lista de servicios -->
                <template x-for="servicio in servicios" :key="servicio.nombre">
                    <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-all duration-200">
                        <div class="flex justify-between items-start">
                            <div class="flex items-center gap-3">
                                <div class="bg-green-100 p-2 rounded-lg">
                                    <i class="fas fa-tag text-green-600"></i>
                                </div>
                                <div>
                                    <h3 x-text="servicio.nombre" class="font-medium text-gray-800"></h3>
                                    <p class="text-sm text-gray-500" x-text="'Categoría: ' + servicio.categoria"></p>
                                    <div class="flex items-center gap-2 mt-1">
                                        <span
                                            :class="servicio.activo ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700'"
                                            class="px-2 py-1 text-xs rounded-full"
                                            x-text="servicio.activo ? 'Activo' : 'Inactivo'"></span>
                                        <span class="text-sm font-medium text-gray-700"
                                            x-text="'S/ ' + servicio.precio"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <a href="/management/services"
                                    class="p-2 text-gray-600 hover:text-[#0891b2] rounded-lg transition-colors">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a class="p-2 text-gray-600 hover:text-red-500 rounded-lg transition-colors"
                                    @click="servicios = servicios.map(srv => srv.nombre === servicio.nombre ? {...srv, activo: false} : srv)">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Modal de Categoria -->
                <div x-show="openCategoryModal" x-cloak="openCategoryModal"
                    x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0"
                    x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-300"
                    x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
                    class="fixed inset-0 bg-gray-800/50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Nueva Categoría</h3>
                            <button @click="openCategoryModal = false" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <form @submit.prevent="addCategory" class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-700">Nombre de la Categoría</label>
                                <input type="text" x-model="newCategoryName"
                                    class="mt-1 w-full px-4 py-2 border border-gray-200 rounded-lg" required>
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-700">Descripción</label>
                                <textarea x-model="newCategoryDescription"
                                    class="mt-1 w-full px-4 py-2 border border-gray-200 rounded-lg" required></textarea>
                            </div>
                            <div class="flex justify-end gap-3">
                                <button type="button" @click="openCategoryModal = false"
                                    class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">
                                    Cancelar
                                </button>
                                <button type="submit"
                                    class="px-4 py-2 bg-[#0891b2] text-white rounded-lg hover:bg-[#0891b2]/90">
                                    Guardar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Modal de Servicio -->
                <div x-show="openServiceModal" x-cloak="openServiceModal"
                    x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0"
                    x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-300"
                    x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
                    class="fixed inset-0 bg-gray-800/50 flex items-center justify-center z-50">
                    <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Nuevo Servicio</h3>
                            <button @click="openServiceModal = false" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <form class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-700">Nombre del Servicio</label>
                                <input type="text" x-ref="nombreServicio"
                                    class="mt-1 w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#0891b2] focus:border-transparent"
                                    placeholder="Nombre del servicio">
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-700">Categoría</label>
                                <select x-ref="categoriaServicio"
                                    class="mt-1 w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#0891b2] focus:border-transparent">
                                    <option value="" disabled selected>Seleccionar categoría</option>
                                    <template x-for="cat in categoria" :key="cat.nombre">
                                        <option :value="cat.nombre" x-text="cat.nombre" :disabled="!cat.activo">
                                        </option>
                                    </template>
                                </select>
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-700">Precio</label>
                                <div class="relative mt-1">
                                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">S/</span>
                                    <input type="number" x-ref="precioServicio"
                                        class="w-full pl-8 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#0891b2] focus:border-transparent"
                                        placeholder="Precio">
                                </div>
                            </div>
                            <div>
                                <label class="text-sm font-medium text-gray-700">Descripción</label>
                                <textarea x-ref="descripcionServicio"
                                    class="mt-1 w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-[#0891b2] focus:border-transparent"
                                    rows="3" placeholder="Descripción del servicio"></textarea>
                            </div>
                            <div class="flex justify-end gap-3">
                                <button type="button" @click="openServiceModal = false"
                                    class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">
                                    Cancelar
                                </button>
                                <button type="button"
                                    @click="servicios.push({nombre: $refs.nombreServicio.value, categoria: $refs.categoriaServicio.value, precio: $refs.precioServicio.value, descripcion: $refs.descripcionServicio.value, activo: true}); openServiceModal = false;"
                                    class="px-4 py-2 bg-[#0891b2] text-white rounded-lg hover:bg-[#0891b2]/90">
                                    Guardar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <script>
            document.addEventListener('alpine:init', () => {
                Alpine.data('configuracion', () => ({
                    openCategoryModal: false,
                    openServiceModal: false,
                    newCategoryName: '',
                    newCategoryDescription: '',
                    categorias: [],
                    servicios: [],

                    init() {
                        this.fetchCategorias();
                        this.fetchServicios();
                    },

                    async fetchCategorias() {
                        try {
                            const response = await fetch('/serviceLaundry/categories');
                            const data = await response.json();
                            this.categorias = data;
                        } catch (error) {
                            console.error('Error al obtener categorías:', error);
                        }
                    },

                    async fetchServicios() {
                        try {
                            const response = await fetch('/serviceLaundry/services');
                            const data = await response.json();
                            this.servicios = data;
                        } catch (error) {
                            console.error('Error al obtener servicios:', error);
                        }
                    },

                    async addCategory() {
                        try {
                            const formData = new FormData();
                            formData.append('nombre', this.newCategoryName);
                            formData.append('descripcion', this.newCategoryDescription);

                            const response = await fetch('/serviceLaundry/categories/add', {
                                method: 'POST',
                                body: formData
                            });

                            const data = await response.json();

                            if (data.status === 'success') {
                                await this.fetchCategorias();
                                this.newCategoryName = '';
                                this.newCategoryDescription = '';
                                this.openCategoryModal = false;
                            } else {
                                alert('Error: ' + data.message);
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('Error al agregar la categoría');
                        }
                    },

                    async addService() {
                        try {
                            const servicioData = {
                                nombre: this.$refs.nombreServicio.value,
                                detalle: this.$refs.descripcionServicio.value,
                                precio: parseFloat(this.$refs.precioServicio.value),
                                categoriaNombre: this.$refs.categoriaServicio.value
                            };

                            const response = await fetch('/serviceLaundry/services/add', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(servicioData)
                            });

                            const data = await response.json();

                            if (data.status === 'success') {
                                await this.fetchServicios();
                                this.openServiceModal = false;
                                this.$refs.nombreServicio.value = '';
                                this.$refs.descripcionServicio.value = '';
                                this.$refs.precioServicio.value = '';
                                this.$refs.categoriaServicio.value = '';
                            } else {
                                alert('Error: ' + data.message);
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('Error al agregar el servicio');
                        }
                    }
                }));
                
            });
        </script>